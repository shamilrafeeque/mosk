{% load static %}
    <!-- END nav -->
{% include 'accounts/header.html'  %}

{% comment %} <div class="hero-wrap hero-bread" style="background-image: url('/static/images/bg_6.jpg');">
    <div class="container">'
    <div class="row no-gutters slider-text align-items-center justify-content-center">
        <div class="col-md-9 ftco-animate text-center">
        <p class="breadcrumbs"><span class="mr-2"><a href="index.html">Home</a></span> <span>Cart</span></p>
        <h1 class="mb-0 bread">My Wishlist</h1>
        </div>
    </div>
    </div>
</div> {% endcomment %}

    <section class="ftco-section ftco-cart">
		<div class="container">
			<h4 class="text-center">Review Your Order and make Payment</h4>
			<div class="row">
                
    			<div class="col-md-7 ftco-animate">
    				<div class="card">
                        <div class="card-header">
                          Billing Address
                        </div>
                        <div class="card-body">
                          <p class="card-text">{{order.full_name}}</p>
                          <p class="card-text">{{order.full_address}}</p>
                          <p class="card-text">{{order.city}},{{order.state}}</p>
                          <p class="card-text">{{order.country}}</p>
                          <p class="card-text">{{order.email}}</p>
                          <p class="card-text">{{order.phone}}</p>
                        </div>
                      </div>
                      <div class="card">
                        <div class="card-header">
                          Payment method
                        </div>
                        <div class="card-body">
                          <p class="card-text">paypal</p>
                        </div>
                      </div>
                      <div class="card">
                        <div class="card-header">
                          Review product
                        </div>
                        <div class="card-body">
                            <table class="tables">
                                <thead class="thead-primary">
                                  <tr class="text-center">
                                    <th>&nbsp;</th>
                                    <th>product</th>
                                    <th>Prize</th>
                                    <!--<th>Price</th>-->
                                    <th>Quantity</th>
                                    <th>Total</th>
                                  </tr>
                                </thead> 
                                 <tbody>
                                  {% for cart_item in cart_items %}
                                  <tr class="text-center">
                                    
                                   
                                    <td class="image-prod"><div class="img" style="background-image:url('{{ cart_item.product.images.url }}');"></div></td>
                                    
                                    <td class="product-name">
                                        <a class='btn btn-link'  href="{{ cart_item.product.get_url}}"><h3>{{ cart_item.product.product_name }}</h3></a>
                                        <p class="text-muted small">
                                        {% if cart_item.variations.all%}
                                          {% for item in cart_item.variations.all %}
                                            {{item.variation_category |capfirst}}:{{item.variation_value |capfirst}}<br>
                                          {% endfor %}

                                        {% endif %}
                                      </p>
                                        <!--<p>{{ cart_item.product.description }}</p>-->
                                    </td>
                                    
                                    <td class="price">₹{{cart_item.product.price}}</td>
                                    <td>
                                        
                                
                                    <div class="col">
                                    <!--<td class="quantity">
                                        <div class="input-group mb-3">-->
                                          <div class="input-group input-spinner">
                                            
                                           <label for="">{{ cart_item.quantity }}</label>
                                            						
                                          </div>
                                          </div>
                                  </td>
                                    
                                    <td class="total">₹{{ cart_item.sub_total }}</td>
                                  </tr><!-- END TR-->
                                  {% endfor %}
                                  
                                </tbody>
                              </table>
                        </div>
                      </div>
	    				{% comment %} <table class="table">
						    <thead class="thead-primary">
						      <tr class="text-center">
						        <th>&nbsp;</th>
						        <th>&nbsp;</th>
						        <th>Product</th>
						        <th>Price</th>
						        <th>Quantity</th>
						        <th>Total</th>
						      </tr>
						    </thead>
						    <tbody>
                               {% for cart_item in cart_items %}
						       <tr class="text-center">
						        	<td class="product-remove"><a href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}" onclick="return confirm('Are you want to delete')"><span class="ion-ios-close"></span></a></td>
						        
						        	<td class="image-prod"><div class="img" style="background-image:url('{{ cart_item.product.images.url }}');"></div></td>
						        
						        	<td class="product-name">
										<a class='btn btn-link'  href="{{ cart_item.product.get_url}}"><h3>{{ cart_item.product.product_name }}</h3></a>
										<p class="text-muted small">
										{% if cart_item.variations.all%}
											{% for item in cart_item.variations.all %}
												{{item.variation_category |capfirst}}:{{item.variation_value |capfirst}}<br>
											{% endfor %}

										{% endif %}
										</p>
						        		<p>{{ cart_item.product.description }}</p>
						        	</td>
						        
						        	<td class="price">₹{{cart_item.product.price}}</td>
						        	<td>
									
							
										<div class="col">
										<!--<td class="quantity">
											<div class="input-group mb-3">-->
											<div class="input-group input-spinner">
												<div class="input-group-prepend">
													<a href ="{% url 'remove_cart' cart_item.product.id cart_item.id%}"><button class="btn btn-light" type="submit" id="button class"><i class ="fa fa-plus"></i>-</button></a>
												</div>
												<label for="" name="quantity" class="form-control">{{ cart_item.quantity }}</label>
												<div class="input-group-append">
													<form action="{% url 'add_cart' cart_item.product.id %}" method="POST">
														{% csrf_token %}
														{% for item in cart_item.variations.all%}
															<input type="hidden" name="{{item.variation_category |lower}}" value="{{item.variation_value | capfirst}}">
														{% endfor %}
													<button class="btn btn-light" type="submit" id="button class"><i class ="fa fa-plus"></i>+</button>
													</form>
											    </div>								
											</div>
											</div>
									</td>
										
										<td class="total">₹{{ cart_item.sub_total }}</td>
									</tr><!-- END TR-->
							  {% endfor %}
						      
						    </tbody>
						  </table> {% endcomment %}
					  {% comment %} </div> {% endcomment %}
    			</div>
    		
    		{% comment %} <div class="row justify-content-start"> {% endcomment %}
    			<div class="col col-lg-5 col-md-5 mt-5 cart-wrap ftco-animate">
    				<div class="cart-total mb-3">
    					<h3>Cart Totals</h3>
    					<p class="d-flex">
    						<span>Subtotal</span>
    						<span>$20.60</span>
    					</p>
    					<p class="d-flex">
    						<span>Delivery</span>
    						<span>$0.00</span>
    					</p>
    					<p class="d-flex">
    						<span>Discount</span>
    						<span>$3.00</span>
    					</p>
    					<hr>
    					<p class="d-flex total-price">
    						<span>Total</span>
    						<span>₹{{total}}</span>
    					</p>
    				
                    <div id="paypal-button-container">
                        
                        <!--paypal button will load-->
                    </div>
    			
    		</div>
			</div>
        </div>
    </section>
    <script src="https://www.paypal.com/sdk/js?client-id=AWM1Qh7_3a8BGIgogRkiU0hJ9mq-Yc3E2qsmLdSyrga32Mcv-ZuSxVgVrgIwXI8fxJORsZ_jXFNe9zNq&currency=USD"></script>

    <script>
        


      function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
              const cookies = document.cookie.split(';');
              for (let i = 0; i < cookies.length; i++) {
                  const cookie = cookies[i].trim();
                  // Does this cookie string begin with the name we want?
                  if (cookie.substring(0, name.length + 1) === (name + '=')) {
                      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                      break;
                  }
              }
          }
          return cookieValue;
      }
      
    var amount = "{{ total }}"
    var url    = "{% url 'payments' %}"
    var csrftoken = getCookie('csrftoken');
    var orderID  =  "{{order.order_number}}"
    var payment_method = 'Paypal'
    var redirect_url="{% url 'order_complete' %}"


// Render the PayPal button into #paypal-button-container
paypal.Buttons({

  // Set up the transaction
  createOrder: function(data, actions) {
      return actions.order.create({
          purchase_units: [{
              amount: {
                  value: amount*0.013,
              }
          }] 
      });
  },

  // Finalize the transaction
  onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
          // Successful capture! For demo purposes:
          // console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
          // var transaction = orderData.purchase_units[0].payments.captures[0];

          console.log(details);
          sendData();
          function sendData(){
              fetch(url, {
                  method : "POST",
                  headers: {
                      "Content-type": "application/json",
                      "X-CSRFToken":  csrftoken,
                  },
                  body: JSON.stringify({
                      orderID : orderID,
                      transID : details.id,
                      payment_method : payment_method,
                      status : details.status,
                  }),
              })
              .then(response => response.json())
              .then(data => {
                  window.location.href = redirect_url + '?order_number=' + data.order_number+'&payment_id='+data.transID;



              });
              }
          
           

          // Replace the above to show a success message within this page, e.g.
          // const element = document.getElementById('paypal-button-container');
          // element.innerHTML = '';
          // element.innerHTML = '<h3>Thank you for your payment!</h3>';
          // Or go to another URL:  actions.redirect('thank_you.html');
      });
  }


}).render('#paypal-button-container');
</script>




    


  {% include 'accounts/footer.html'  %}
  
  
  <!-- loader -->
  {% include 'accounts/loader.html'  %}
  
  <script>
        $(document).ready(function(){
  
        var quantitiy=0;
           $('.quantity-right-plus').click(function(e){
                
                // Stop acting like a button
                e.preventDefault();
                // Get the field name
                var quantity = parseInt($('#quantity').val());
                
                // If is not undefined
                    
                    $('#quantity').val(quantity + 1);
  
                  
                    // Increment
                
            });
  
             $('.quantity-left-minus').click(function(e){
                // Stop acting like a button
                e.preventDefault();
                // Get the field name
                var quantity = parseInt($('#quantity').val());
                
                // If is not undefined
              
                    // Increment
                    if(quantity>0){
                    $('#quantity').val(quantity - 1);
                    }
            });
            
        });
        
    </script>
  